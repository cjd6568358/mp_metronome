var e=require("D2781B611874D7CFB41E7366F1A8C176.js"),a=require("2F5D89511874D7CF493BE15645B8C176.js"),t=require("0C1254531874D7CF6A743C545888C176.js");App({globalData:{version:"2.0.3",platform:"",keepScreenOn:!0,vibrateAccent:!1,darkMode:"2",backgroundModeOn:!1,upbeatOn:!1,innerMode:!1,darkTheme:"dark",theme:"blue",showTempoCount:!1,customBar:0,statusBar:0,navBarHeight:0,isFront:1,isWebAudio:0,playing:0,playingBackup:0,beatCount:0,barCount:0,curItemIndex:0,bpmSpeed:60,tempo:{duration:4,durationIndex:2,length:4,lengthIndex:3},tone:0,isVoice:0,items:[{state:0,level:3},{state:0,level:1},{state:0,level:2},{state:0,level:1}],subdiv:"T_1",subdivs:[],activeTone:"轻板",backgroundAudioManager:null,backgroundAudioFilepath:"".concat(wx.env.USER_DATA_PATH,"/temp-audio-ABC.wav"),globalPlayAudioBuffer:null,playerReady:!1,globalPlayAudioBufferSource:new Set,playerTimerIntervals:new Set,workerBeatIntervals:new Set,countDownTimerIntervals:new Set,itemDuration:0,timerRunning:0,resumeTimer:0,playCount:2,muteCount:0,userInfo:null,lastPlayTime:null,lastReportTime:0,toneAudios:[{id:0,name:"轻板",vip:0,count:3,files:{tone_1:"https://lukehui.oss-cn-beijing.aliyuncs.com/cheers/mp3/audios/tone-1-1.mp3",tone_2:"https://lukehui.oss-cn-beijing.aliyuncs.com/cheers/mp3/audios/tone-1-2.mp3",tone_3:"https://lukehui.oss-cn-beijing.aliyuncs.com/cheers/mp3/audios/tone-1-3.mp3"}}],clockDays:1,showClockDialog:!1,refreshUserInfo:0,subNotes:{T_1:{duration:[1],icon:"1.svg"},T_2_2:{duration:[.5,.5],icon:"22.svg"},T_0_2:{duration:[-.5,.5],icon:"02.svg"},T_3_3_3:{duration:[1/3,1/3,1/3],icon:"333.svg"},T_0_3_3:{duration:[-1/3,1/3,1/3],icon:"033.svg"},T_3_0_3:{duration:[1/3,-1/3,1/3],icon:"303.svg"},T_3_3_0:{duration:[1/3,1/3,-1/3],icon:"330.svg"},T_0_3_0:{duration:[-1/3,1/3,-1/3],icon:"030.svg"},T_0_0_3:{duration:[-1/3,-1/3,1/3],icon:"003.svg"},T_4_4_4_4:{duration:[1/4,1/4,1/4,1/4],icon:"4444.svg"},T_0_4_0_4:{duration:[-1/4,1/4,-1/4,1/4],icon:"0404.svg"},T_3_1:{duration:[3/4,1/4],icon:"31.svg"},T_1_3:{duration:[1/4,3/4],icon:"13.svg"},T_4_4_2:{duration:[1/4,1/4,.5],icon:"442.svg"},T_2_4_4:{duration:[.5,1/4,1/4],icon:"244.svg"},T_4_2_4:{duration:[1/4,.5,1/4],icon:"424.svg"}},trainIng:0,trainMode:"1",trainCurIndex:0,trainCurBar:0,promoDiscount:0,promoDiscountEnd:""},onLaunch:function(){var a=this;if(e.request(t.appConfig,{},"GET").then((function(e){200==e.code&&(a.globalData.promoDiscount=e.data.promo_discount,a.globalData.promoDiscountEnd=e.data.promo_discount_end,e.data.in_view==a.globalData.version?a.globalData.platform="ios":wx.getSystemInfo({success:function(e){"ios"==e.platform?a.globalData.platform="ios1":a.globalData.platform=e.platform}}))})),e.request(t.toneConfig,{},"GET").then((function(e){if(200==e.code){var t=e.data;a.globalData.toneAudios=t.sort((function(e,a){return e.id-a.id}))}})),a.checkUpdateVersion(),wx.getSystemInfo({success:function(e){var t=wx.getMenuButtonBoundingClientRect(),o=wx.getSystemInfoSync();a.globalData.customBar=t.height-6,a.globalData.statusBar=t.top+6,a.globalData.navBarHeight=2*(t.top-o.statusBarHeight)+t.height+o.statusBarHeight}}),wx.getStorage({key:"keepScreenOn",success:function(e){e.data?a.globalData.keepScreenOn=e.data:wx.setStorageSync("keepScreenOn",!0)}}),wx.getStorage({key:"vibrateAccent",success:function(e){e.data?a.globalData.vibrateAccent=e.data:wx.setStorageSync("vibrateAccent",!1)}}),wx.getStorage({key:"darkMode",success:function(e){e.data?a.globalData.darkMode=e.data:wx.setStorageSync("darkMode","2")}}),wx.getStorage({key:"theme",success:function(e){e.data?a.globalData.theme=e.data:wx.setStorageSync("theme","blue")}}),wx.getStorage({key:"backgroundModeOn",success:function(e){e.data?a.globalData.backgroundModeOn=e.data:wx.setStorageSync("backgroundModeOn",!1)}}),wx.getStorage({key:"innerMode",success:function(e){e.data?a.globalData.innerMode=e.data:wx.setStorageSync("innerMode",!1)}}),wx.getStorage({key:"showTempoCount",success:function(e){e.data?a.globalData.showTempoCount=e.data:wx.setStorageSync("showTempoCount",!1)}}),"0"===a.globalData.darkMode){var o=wx.getSystemInfoSync();a.globalData.darkTheme=o.theme}else"1"===a.globalData.darkMode?a.globalData.darkTheme="light":"2"===a.globalData.darkMode&&(a.globalData.darkTheme="dark");var n=a.globalData.subdiv.split(",");if(n.length<a.globalData.tempo.length){n=[];for(var s=0;s<a.globalData.tempo.length;s++)n.push(a.globalData.subdiv)}a.globalData.subdivs=n,console.log("==subdivs==",a.globalData.subdivs),wx.loadFontFace({family:"DINAlternate-Bold",source:"url(https://lukehui.oss-cn-beijing.aliyuncs.com/cheers/image/DIN-BoldAlternate.ttf)",success:function(e){console.log("font load success")},fail:function(e){console.log("font load fail",e)}});var i=wx.getFileSystemManager();i.readdir({dirPath:"".concat(wx.env.USER_DATA_PATH,"/"),success:function(e){if(e.files.length)for(var a=0;a<e.files.length;a++)if(e.files[a].indexOf("temp-audio")>-1){var t="".concat(wx.env.USER_DATA_PATH,"/")+e.files[a];console.log("file:",t),i.unlink({filePath:t,success:function(e){console.log(e)},fail:function(e){console.error(e)}})}console.log(e.files)},fail:function(e){console.error("=readdir=",e)}})},onShow:function(){console.log("app.show");this.globalData.isFront=1,wx.login({success:function(a){e.request(t.authLogin,{code:a.code},"POST").then((function(a){if(200==a.code){var o=a.access_token;o&&(wx.setStorageSync("token",o),e.request(t.showUser,{},"POST").then((function(e){200==e.code&&wx.setStorageSync("userInfo",e.data)})))}})).then((function(){var a=wx.getStorageSync("playlist")||[];e.request(t.syncPlaylist,{playlists:JSON.stringify(a)},"POST").then((function(e){200==e.code&&0==a.length&&e.data.length>0&&wx.setStorageSync("playlist",e.data)}))}))}})},watch:function(e,a){var t=this.globalData,o=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!0,set:function(t){o=t,a(e,t)},get:function(){return o}})},checkUpdateVersion:function(){if(wx.canIUse("getUpdateManager")){var e=wx.getUpdateManager();e.onCheckForUpdate((function(a){a.hasUpdate&&(e.onUpdateReady((function(){wx.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success:function(a){a.confirm&&e.applyUpdate()}})})),e.onUpdateFailed((function(){wx.showModal({title:"已经有新版本喽~",content:"请您删除当前小程序，重新搜索打开哦~"})})))}))}else wx.showModal({title:"溫馨提示",content:"当前微信版本过低，请升级到最新微信版本后重试。"})},setTabBar:function(e,a){"function"==typeof a.getTabBar&&a.getTabBar()&&a.getTabBar().setData({selected:e,darkTheme:this.globalData.darkTheme})},onShareAppMessage:function(){return{title:"推荐一个专业节拍器，我就是用的这个！",path:"/pages/index/index",imageUrl:"https://lukehui.oss-cn-beijing.aliyuncs.com/cheers/image/share-img.png"}},onShareTimeline:function(){return{title:"推荐一个专业节拍器，无需安装，打开就能用",query:"",imageUrl:"https://lukehui.oss-cn-beijing.aliyuncs.com/cheers/image/share-img.png"}},workerStart:function(e){n.postMessage({action:"start",interval:e})},workerRestart:function(e){n.postMessage({action:"restart",interval:e})},workerStop:function(){n.postMessage({action:"stop"})},reportRecord:function(){var a=this,o=(new Date).getTime(),n=o-a.globalData.lastPlayTime;if(a.globalData.lastPlayTime&&!(o-a.globalData.lastReportTime<=1e4)){for(var s=[],i=0;i<a.globalData.items.length;i++)s.push(a.globalData.items[i].level);console.log("==reportRecord=="),a.globalData.lastReportTime=o,n>=3e4&&e.request(t.addRecord,{bpm:a.globalData.bpmSpeed,tone:a.globalData.tone,tempo:a.globalData.tempo.length+"/"+a.globalData.tempo.duration,minutes:Math.round(n/6e4),subdiv:a.globalData.subdiv,start_at:a.globalData.lastPlayTime,end_at:o,items:s.join(",")},"POST").then((function(e){200==e.code&&(a.globalData.lastPlayTime=null,1==e.data.is_first&&wx.vibrateLong(),a.globalData.clockDays=e.data.continuous_days,a.globalData.showClockDialog=1==e.data.is_first,21==e.data.continuous_days&&(a.globalData.refreshUserInfo=a.globalData.refreshUserInfo+1))}))}}});var o=0,n=wx.createWorker("worker/timer.js",{useExperimentalWorker:!0});n.onMessage((function(e){var t=getApp();o++,a.itemBeat(),t.globalData.workerBeatIntervals=new Set(JSON.parse(e).set),o%64==63&&(t.workerRestart(t.globalData.itemDuration),console.log("=restart worker=="))})),n.onProcessKilled((function(e){console.error(e),n=wx.createWorker("worker/timer.js",{useExperimentalWorker:!0})}));