Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@babel/runtime/helpers/toConsumableArray.js"),t=require("@babel/runtime/helpers/objectSpread2.js"),a=require("@babel/runtime/helpers/createForOfIteratorHelper.js"),r=require("50B40F501874D7CF36D267574997C176.js"),n=require("927AB8341874D7CFF41CD033B558C176.js"),o=require("9DD93E011874D7CFFBBF56066C77C176.js");function i(e,t){if(!e||!t||!t.length)return!1;var r,o=n.dateUtil.toTimeStr(e),i=!1,d=a(t);try{for(d.s();!(r=d.n()).done;){var l=r.value;if(n.dateUtil.toTimeStr(l)===o)return i=!0;i=!1}}catch(e){d.e(e)}finally{d.f()}return i}function d(e,t){if(e){var a=e.year,r=e.month,o=n.dateUtil.calcDates(a,r),d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=a.firstDayOfWeek,o="Mon"===r,i=e.year,d=e.month,l=n.dateUtil.getDayOfWeek(i,d,1);o&&0===l&&(l=7);var c=[0,7-l],h=c[1];return t.slice(0,o?h+1:h)}(e,o,t),l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=a.firstDayOfWeek,o="Mon"===r,i=e.year,d=e.month,l=n.dateUtil.getDatesCountOfMonth(i,d),c=n.dateUtil.getDayOfWeek(i,d,l);o&&0===c&&(c=7);var h=l-c,u=l;return t.slice(o?h:h-1,u)}(e,o,t);return i(e,d)?function(e,t){for(var a=e.year,r=e.month,o=n.dateUtil.getPrevMonthInfo({year:a,month:r}),i=n.dateUtil.getDatesCountOfMonth(o.year,o.month),d=t,l=t.length,c=0;c<7-l;c++){var h=n.dateUtil.getDayOfWeek(+a,+r,i);d.unshift({year:o.year,month:o.month,date:i,week:h}),i-=1}return d}(e,d):i(e,l)?function(e,t){for(var a=e.year,r=e.month,o=n.dateUtil.getNextMonthInfo({year:a,month:r}),i=t,d=t.length,l=0;l<7-d;l++){var c=n.dateUtil.getDayOfWeek(+a,+r,l+1);i.push({year:o.year,month:o.month,date:l+1,week:c})}return i}(e,l):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.year,o=e.month,i=e.date,d=n.dateUtil.getDayOfWeek(r,o,i),l=a.firstDayOfWeek,c="Mon"===l;if(c){var h=i-(d||7);return t.splice(h,7)}var u=i-d-1;return t.splice(u,7)}(e,o,t)}}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dates,a=void 0===t?[]:t;return a[a.length-1]}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dates;return t[0]}function h(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=a.curYear,o=a.curMonth,i=[],d=l(a),c=d.year,h=d.month;r!==c||o!==h?(i=n.dateUtil.calcDates(c,h),r=c,o=h):i=n.dateUtil.calcDates(r,o);var u=n.dateUtil.getDatesCountOfMonth(r,o),s=u-d.date,f=i.findIndex((function(e){return n.dateUtil.toTimeStr(e)===n.dateUtil.toTimeStr(d)})),v=f+1;if(s>=7)return{dates:i.splice(v,7),year:r,month:o};var g=n.dateUtil.getNextMonthInfo({year:r,month:o}),m=g||{},D=m.year,y=m.month,M=n.dateUtil.calcDates(D,y),U=i.splice(v),p=M.splice(0,7-U.length);return t({dates:[].concat(e(U),e(p))},g)}function u(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=a.curYear,o=a.curMonth,i=c(a),d=[],l=i.year,h=i.month;r!==l||o!==h?(d=n.dateUtil.calcDates(l,h),r=l,o=h):d=n.dateUtil.calcDates(r,o);var u=d.findIndex((function(e){return n.dateUtil.toTimeStr(e)===n.dateUtil.toTimeStr(i)}));if(u-7>=0){var s=u-7;return{dates:d.splice(s,7),year:r,month:o}}var f=n.dateUtil.getPrevMonthInfo({year:r,month:o}),v=f||{},g=v.year,m=v.month,D=n.dateUtil.calcDates(g,m),y=d.splice(0,i.date-1),M=D.splice(-(7-y.length));return t({dates:[].concat(e(M),e(y))},f)}exports.default=function(){return{name:"week",beforeRender:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=e.initializedWeekMode,i=e.selectedDates;if(a.weekMode&&!o){var d=a.defaultDate,l=i&&i[0]||d&&n.dateUtil.transformDateRow2Dict(d)||n.dateUtil.todayFMD(),c=this.methods(r).__calcDatesWhenSwitchView("week",l),h=c||{},u=h.data,s=h.config,f=this.methods(r).__selectTargetDateWhenJump(l,u.dates,s);return{calendarData:t(t(t({},u),f),{},{weeksCh:n.dateUtil.getWeekHeader(a.firstDayOfWeek),initializedWeekMode:!0}),calendarConfig:a}}return{calendarData:e,calendarConfig:a}},onSwitchCalendar:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=e.direction,i=a.curYear,d=a.curMonth,l=(0,n.getCalendarConfig)(r);if(l.weekMode){var c="left"===o?h(a):u(a),s=c.dates,f=c.year,v=c.month;return t(t({},a),{},{dates:s,curYear:f||i,curMonth:v||d})}return a},methods:function(e){var a=this;return{__selectTargetDateWhenJump:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=e,i=a.map((function(a,i){var d=t({},a);return d.id=i,n.dateUtil.toTimeStr(e)===n.dateUtil.toTimeStr(d)&&!e.choosed&&r.autoChoosedWhenJump&&(d.choosed=!0,o=d),d}));return{dates:i,selectedDates:[o]}},__calcDatesForWeekMode:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e||{},o=n.year,i=n.month,l=d(e,a);return l.forEach((function(e,t){return e.id=t})),{data:t(t({},r),{},{prevMonthGrids:null,nextMonthGrids:null,dates:l,curYear:o,curMonth:i}),config:t(t({},a),{},{weekMode:!0})}},__calcDatesForMonthMode:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e||{},i=n.year,d=n.month,l=(0,o.calcJumpData)({dateInfo:e,config:a});return{data:t(t(t({},r),l),{},{curYear:i,curMonth:d}),config:t(t({},a),{},{weekMode:!1})}},__calcDatesWhenSwitchView:function(t,r){var o=(0,n.getCalendarConfig)(e);if(o.multi)return n.logger.warn("多选模式不能切换周月视图");var i=(0,n.getCalendarData)("calendar",e)||{},d=i.selectedDates,l=void 0===d?[]:d,c=i.dates,h=void 0===c?[]:c,u=i.curYear,s=i.curMonth,f=l.filter((function(e){return u===+e.year||s===+e.month})),v={};return v=r||(f.length?f.pop():h[0]),"week"===t?a.methods(e).__calcDatesForWeekMode(v,o,i):a.methods(e).__calcDatesForMonthMode(v,o,i)},weekModeJump:function(o){var i=o||n.dateUtil.todayFMD(),d=(0,n.getCalendarData)("calendar",e)||{},l=a.methods(e).__calcDatesWhenSwitchView("week",i)||{},c=l.data,h=l.config,u=a.methods(e).__selectTargetDateWhenJump(i,c.dates,h);return r.renderCalendar.call(e,t(t(t({},d),c),u),h)},switchView:function(t,o){var i=a.methods(e).__calcDatesWhenSwitchView(t,o)||{},d=i.data,l=i.config;return d?r.renderCalendar.call(e,d,l):n.logger.warn("当前状态不能切换为周视图")}}}}};