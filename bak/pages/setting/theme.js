var e=require("../../@babel/runtime/helpers/defineProperty"),a=require("../../D2781B611874D7CFB41E7366F1A8C176.js"),t=require("../../0C1254531874D7CF6A743C545888C176.js"),o=getApp();Page({data:{darkMode:"2",darkTheme:"dark",theme:"blue",userInfo:{isVip:!1},statusBar:o.globalData.statusBar,customBar:o.globalData.customBar,navBarHeight:o.globalData.navBarHeight,systemConfOn:!1,colors:[{name:"blue",color:"#03CED3",title:"湖光山色"},{name:"orange",color:"#FFA100",title:"万寿菊黄"},{name:"red",color:"#E41F3B",title:"山茶花红"},{name:"light-green",color:"#4EEAAB",title:"青海玉绿"},{name:"purple",color:"#7157BE",title:"淡藤萝紫"},{name:"pink",color:"#FE4CEB",title:"霓虹亮粉"},{name:"dark-blue",color:"#4C64FE",title:"克莱因蓝"},{name:"green",color:"#2D8443",title:"三叶草绿"},{name:"light-red",color:"#FE6B8B",title:"宫廷红粉"},{name:"cyan",color:"#007F9E",title:"卡布里兰"},{name:"yellow",color:"#EDC000",title:"初熟杏黄"},{name:"light-purple",color:"#997CF7",title:"丁香淡紫"}],refreshUserInfo:0},onLoad:function(e){var a=this;a.initWatchListener(),wx.onThemeChange((function(e){"0"==o.globalData.darkMode&&(o.globalData.darkTheme=e.theme,a.setData({darkTheme:e.theme}),console.log("changetheme:",e.theme))}))},onShow:function(){this.refreshUserInfo(),this.setData({darkMode:o.globalData.darkMode,darkTheme:o.globalData.darkTheme,theme:o.globalData.theme,systemConfOn:"0"===o.globalData.darkMode}),wx.setNavigationBarColor({frontColor:"dark"==o.globalData.darkTheme?"#ffffff":"#000000",backgroundColor:"dark"==o.globalData.darkTheme?"#000000":"#ffffff"}),wx.setStorageSync("themeVisited",(new Date).getTime())},initWatchListener:function(){o.watch("refreshUserInfo",this.watchBack)},watchBack:function(a,t){this.setData(e({},"".concat(a),t)),"refreshUserInfo"===a&&this.refreshUserInfo()},onShareAppMessage:function(){return o.onShareAppMessage()},onShareTimeline:function(){return o.onShareTimeline()},tapBack:function(){wx.navigateBack({delta:1})},switchDarkMode:function(e){var a=1==e.detail.value?"2":"1",t=1==e.detail.value?"dark":"light";o.globalData.darkMode=a,o.globalData.darkTheme=t,this.setData({darkMode:a,darkTheme:t,systemConfOn:!1});try{wx.setStorageSync("darkMode",a)}catch(e){VM2_INTERNAL_STATE_DO_NOT_USE_OR_PROGRAM_WILL_FAIL.handleException(e)}},switchSystemConf:function(e){var a=wx.getSystemInfoSync(),t=1==e.detail.value?"0":"light"==a.theme?"1":"2",r="0"==t?a.theme:"1"==t?"light":"dark";o.globalData.darkMode=t,o.globalData.darkTheme=r,this.setData({darkMode:t,darkTheme:r,systemConfOn:!this.data.systemConfOn});try{wx.setStorageSync("darkMode",t)}catch(e){VM2_INTERNAL_STATE_DO_NOT_USE_OR_PROGRAM_WILL_FAIL.handleException(e)}},tapColor:function(e){var a=e.currentTarget.dataset.color;return this.data.userInfo&&!this.data.userInfo.isVip&&"blue"!=a?(this.handleShowVip(),!1):a!=this.data.theme&&(o.globalData.theme=a,this.setData({theme:a}),wx.setStorageSync("theme",a),void wx.showToast({title:"切换成功",icon:"success",duration:1e3}))},checkVip:function(){if(this.data.userInfo&&!this.data.userInfo.isVip)return this.handleShowVip(),!1},handleShowVip:function(){wx.navigateTo({url:"/pages/vip/index"})},refreshUserInfo:function(){var e,o=this;a.request(t.showUser,{},"POST").then((function(a){200==a.code&&(e=a.data,wx.setStorageSync("userInfo",a.data),o.setData({userInfo:{isVip:!!e&&e.is_vip,vipExpireTime:e&&e.is_vip&&e.vip_expire_time?e.vip_expire_time:""}}))}))}});